var h=Object.defineProperty;var d=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>d(r,typeof e!="symbol"?e+"":e,t);import{u as a}from"./index-BzUcgayr.js";class g{constructor(){u(this,"notifications",[]);this.requestPermission(),this.scheduleDefaultReminders()}async requestPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("This browser does not support notifications"),!1)}scheduleDefaultReminders(){localStorage.getItem("clear.notifications")==="1"&&(this.scheduleRecurringReminder({id:"daily-checkin",type:"checkin",title:"ðŸŒŸ Daily Wellness Check-in",message:"How are you feeling today? Take a moment to check in with yourself.",scheduledFor:Date.now(),isRecurring:!0,recurringDays:[1,2,3,4,5,6,0],recurringTime:"09:00",isActive:!0,createdAt:Date.now()}),this.scheduleRecurringReminder({id:"evening-reflection",type:"reflection",title:"ðŸŒ™ Evening Reflection",message:"Take a few minutes to reflect on your day in your private vault.",scheduledFor:Date.now(),isRecurring:!0,recurringDays:[1,2,3,4,5,6,0],recurringTime:"20:00",isActive:!0,createdAt:Date.now()}),this.scheduleRecurringReminder({id:"weekly-wellness",type:"wellness",title:"ðŸ“Š Weekly Wellness Review",message:"Check your wellness insights and celebrate your progress!",scheduledFor:Date.now(),isRecurring:!0,recurringDays:[0],recurringTime:"10:00",isActive:!0,createdAt:Date.now()}))}scheduleRecurringReminder(e){if(!e.isRecurring||!e.recurringDays||!e.recurringTime)return;const[t,i]=e.recurringTime.split(":").map(Number);e.recurringDays.forEach(n=>{const s=new Date,o=new Date,c=(n-s.getDay()+7)%7;o.setDate(s.getDate()+(c===0&&s.getHours()>=t?7:c)),o.setHours(t,i,0,0),o<=s&&o.setDate(o.getDate()+7),this.scheduleNotification(e,o.getTime())})}scheduleNotification(e,t){const i=t-Date.now();i<=0||setTimeout(()=>{this.showNotification(e),e.isRecurring&&this.scheduleRecurringReminder(e)},i)}async showNotification(e){if(!await this.requestPermission())return;const i=new Notification(e.title,{body:e.message,icon:"/pwa-192x192.png",badge:"/favicon.svg",tag:e.id,requireInteraction:!1,actions:[{action:"open",title:"Open Clear"},{action:"snooze",title:"Remind me later"}]});i.onclick=()=>{window.focus(),i.close(),e.type==="checkin"?window.location.hash="#/checkin":e.type==="reflection"?window.location.hash="#/vault":e.type==="wellness"&&(window.location.hash="#/insights")},this.notifications.push(i)}checkStreakReminders(){const e=a.getState().checkIns,t=e[e.length-1],i=Date.now(),n=i-24*60*60*1e3;if(!t||t.createdAt<n){const s=t?Math.floor((i-t.createdAt)/864e5):1;s===1?this.showNotification({id:"streak-warning",type:"checkin",title:"ðŸ”¥ Don't break your streak!",message:"You haven't checked in today. Keep your wellness journey going!",scheduledFor:i,isRecurring:!1,isActive:!0,createdAt:i}):s===3&&this.showNotification({id:"comeback-gentle",type:"checkin",title:"ðŸ’™ We miss you",message:"No pressure, but your wellness matters. Come back when you're ready.",scheduledFor:i,isRecurring:!1,isActive:!0,createdAt:i})}}checkMoodReminders(){const t=a.getState().checkIns.filter(i=>i.createdAt>Date.now()-7*24*60*60*1e3);if(t.length>=3){const i=t.filter(s=>s.mood==="sad").length,n=t.filter(s=>s.mood==="tired").length;i>=3&&this.showNotification({id:"support-sad",type:"wellness",title:"ðŸ¤— You're not alone",message:"It looks like you've been having a tough time. Consider checking our safety resources.",scheduledFor:Date.now(),isRecurring:!1,isActive:!0,createdAt:Date.now()}),n>=3&&this.showNotification({id:"energy-boost",type:"wellness",title:"âš¡ Feeling tired lately?",message:"You've been feeling tired. Remember to take care of your basics: sleep, food, movement.",scheduledFor:Date.now(),isRecurring:!1,isActive:!0,createdAt:Date.now()})}}checkCelebrationReminders(){const{checkIns:e}=a.getState(),t=this.calculateStreak(e);[7,14,30,60,100].includes(t)&&this.showNotification({id:`celebration-${t}`,type:"wellness",title:`ðŸŽ‰ ${t} Day Streak!`,message:`Amazing! You've checked in for ${t} days in a row. You're building a powerful habit!`,scheduledFor:Date.now(),isRecurring:!1,isActive:!0,createdAt:Date.now()})}calculateStreak(e){if(e.length===0)return 0;const t=new Date;t.setHours(0,0,0,0);let i=0,n=new Date(t);for(let s=0;s<365;s++){const o=n.getTime(),c=o+24*60*60*1e3;if(e.some(l=>l.createdAt>=o&&l.createdAt<c))i++;else break;n.setDate(n.getDate()-1)}return i}startIntelligentReminders(){setInterval(()=>{this.checkStreakReminders(),this.checkMoodReminders(),this.checkCelebrationReminders()},60*60*1e3)}}const y=new g;export{y as reminderService};
